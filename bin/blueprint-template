#!/bin/sh

set -e

if [ -z "$1" ]
then
	echo "Usage: blueprint template <pathname>" >&2
	exit 1
fi

. "$(dirname "$(dirname "$0")")/mustache.sh/lib/mustache.sh"

for PATHNAME in $(find "/etc/blueprint-template.d" -type f -name "*.sh")
do
	echo "# [blueprint-template] sourcing $PATHNAME" >&2
	. "$PATHNAME"
done

if [ -f "$1.blueprint-template.sh" ]
then
	echo "# [blueprint-template] sourcing $1.blueprint-template.sh" >&2
	. "$1.blueprint-template.sh"
fi

mustache <"$1.blueprint-template.mustache" >"$1"
