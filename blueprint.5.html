<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' value='text/html;charset=utf8'>
  <meta name='generator' value='Ronn/v0.7.3 (http://github.com/rtomayko/ronn/tree/0.7.3)'>
  <title>blueprint(5) - blueprint JSON format</title>
  <style type='text/css' media='all'>
  /* style: man */
  body#manpage {margin:0}
  .mp {max-width:100ex;padding:0 9ex 1ex 4ex}
  .mp p,.mp pre,.mp ul,.mp ol,.mp dl {margin:0 0 20px 0}
  .mp h2 {margin:10px 0 0 0}
  .mp > p,.mp > pre,.mp > ul,.mp > ol,.mp > dl {margin-left:8ex}
  .mp h3 {margin:0 0 0 4ex}
  .mp dt {margin:0;clear:left}
  .mp dt.flush {float:left;width:8ex}
  .mp dd {margin:0 0 0 9ex}
  .mp h1,.mp h2,.mp h3,.mp h4 {clear:left}
  .mp pre {margin-bottom:20px}
  .mp pre+h2,.mp pre+h3 {margin-top:22px}
  .mp h2+pre,.mp h3+pre {margin-top:5px}
  .mp img {display:block;margin:auto}
  .mp h1.man-title {display:none}
  .mp,.mp code,.mp pre,.mp tt,.mp kbd,.mp samp,.mp h3,.mp h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  .mp h2 {font-size:16px;line-height:1.25}
  .mp h1 {font-size:20px;line-height:2}
  .mp {text-align:justify;background:#fff}
  .mp,.mp code,.mp pre,.mp pre code,.mp tt,.mp kbd,.mp samp {color:#131211}
  .mp h1,.mp h2,.mp h3,.mp h4 {color:#030201}
  .mp u {text-decoration:underline}
  .mp code,.mp strong,.mp b {font-weight:bold;color:#131211}
  .mp em,.mp var {font-style:italic;color:#232221;text-decoration:none}
  .mp a,.mp a:link,.mp a:hover,.mp a code,.mp a pre,.mp a tt,.mp a kbd,.mp a samp {color:#0000ff}
  .mp b.man-ref {font-weight:normal;color:#434241}
  .mp pre {padding:0 4ex}
  .mp pre code {font-weight:normal;color:#434241}
  .mp h2+pre,h3+pre {padding-left:0}
  ol.man-decor,ol.man-decor li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  ol.man-decor {width:100%}
  ol.man-decor li.tl {text-align:left}
  ol.man-decor li.tc {text-align:center;letter-spacing:4px}
  ol.man-decor li.tr {text-align:right;float:right}
  </style>
  <style type='text/css' media='all'>
  /* style: toc */
  .man-navigation {display:block !important;position:fixed;top:0;left:113ex;height:100%;width:100%;padding:48px 0 0 0;border-left:1px solid #dbdbdb;background:#eee}
  .man-navigation a,.man-navigation a:hover,.man-navigation a:link,.man-navigation a:visited {display:block;margin:0;padding:5px 2px 5px 30px;color:#999;text-decoration:none}
  .man-navigation a:hover {color:#111;text-decoration:underline}
  </style>
</head>
<!--
  The following styles are deprecated and will be removed at some point:
  div#man, div#man ol.man, div#man ol.head, div#man ol.man.

  The .man-page, .man-decor, .man-head, .man-foot, .man-title, and
  .man-navigation should be used instead.
-->
<body id='manpage'>
  <div class='mp' id='man'>

  <div class='man-navigation' style='display:none'>
    <a href="#NAME">NAME</a>
    <a href="#SYNOPSIS">SYNOPSIS</a>
    <a href="#DESCRIPTION">DESCRIPTION</a>
    <a href="#THEME-SONG">THEME SONG</a>
    <a href="#AUTHOR">AUTHOR</a>
    <a href="#SEE-ALSO">SEE ALSO</a>
  </div>

  <ol class='man-decor man-head man head'>
    <li class='tl'>blueprint(5)</li>
    <li class='tc'>Blueprint</li>
    <li class='tr'>blueprint(5)</li>
  </ol>

  <h2 id="NAME">NAME</h2>
<p class="man-name">
  <code>blueprint</code> - <span class="man-whatis">blueprint JSON format</span>
</p>

<h2 id="SYNOPSIS">SYNOPSIS</h2>

<pre><code>{
  "arch": "ARCHITECTURE",
  "files": {
    "PATHNAME": {
      "content": "CONTENT",
      "encoding": "ENCODING",
      "group": "GROUP",
      "mode": "MODE",
      "owner": "OWNER"
    },
    "PATHNAME": {
      "encoding": "ENCODING",
      "group": "GROUP",
      "mode": "MODE",
      "owner": "OWNER",
      "template": "TEMPLATE"
    },
    "PATHNAME": {
      "dat": "DATA"
      "encoding": "ENCODING",
      "group": "GROUP",
      "mode": "MODE",
      "owner": "OWNER",
      "template": "TEMPLATE"
    },
    "PATHNAME": {
      "encoding": "ENCODING",
      "group": "GROUP",
      "mode": "MODE",
      "owner": "OWNER",
      "source": "SOURCE"
    }
  },
  "packages": {
    "MANAGER": {
      "PACKAGE": ["VERSION"],
      "PACKAGE": ["VERSION", "VERSION"]
    },
    "MANAGER": {
      "PACKAGE": ["VERSION"],
      "PACKAGE": ["VERSION"]
    },
    "rpm": {
      "PACKAGE": ["URL"]
    }
  },
  "services": {
    "MANAGER": {
      "SERVICENAME": {
        "enable": true,
        "ensure": "running",
        "files": ["PATHNAME"],
        "packages": {
          "MANAGER": ["PACKAGE"]
        },
        "sources": ["DIRNAME"]
      }
    }
  },
  "sources": {
    "DIRNAME": "FILENAME",
    "DIRNAME": "URL"
  }
}
</code></pre>

<p>(Keys and values written in CAPITALS represent variable data.)</p>

<h2 id="DESCRIPTION">DESCRIPTION</h2>

<p><span class="man-ref"><code>blueprint-create</code><span class="s">(1)</span></span> commits <code>blueprint.json</code> to the appropriate branch in the local blueprint repository.  The format described here is used to generate Puppet modules, Chef cookbooks, and POSIX shell scripts in <span class="man-ref"><code>blueprint-show</code><span class="s">(1)</span></span> and <span class="man-ref"><code>blueprint-apply</code><span class="s">(1)</span></span>.  These sections must be followed in order.</p>

<h3 id="Sources">Sources</h3>

<p>Each key in the optional <code>sources</code> object is the fully-qualified path to a directory.  These directory names should be traversed in alphabetical order.  The associated value is the name of a tarball of the contents of that directory at the time the blueprint was created.  It must be extracted there when the blueprint is applied.  The tarball is stored in Git alongside <code>blueprint.json</code>.</p>

<p>If <code>sources</code> is present and non-empty, <code>arch</code> will also be present indicating the architecture of the server that created the blueprint.  If present, this value will be <em>amd64</em> or <em>i386</em> on Debian-based systems or <em>x86_64</em> or <em>x86</em> on RPM-based systems.  It is legal to refuse to apply a blueprint with a mismatched architecture.  The architecture can be found by running <code>dpkg --print-architecture</code> or <code>rpm --eval %_arch</code> as appropriate.</p>

<p>For compatibility with AWS <code>cfn-init</code>, a URL may appear in the value in place of a filename.  If such a value is encountered, the URL should be fetched and extracted.  Blueprint will never generate such objects.</p>

<h3 id="Files">Files</h3>

<p>Each key in the optional <code>files</code> object is the fully-qualified pathname to a file.  These pathnames should be traversed in alphabetical order.  The associated value contains the <code>owner</code>, owning <code>group</code>, <code>mode</code> (a string containing the full 6-digit octal representation), <code>content</code>, and the <code>encoding</code> of content (one of <em>plain</em> or <em>base64</em>).  Each file must be placed at its pathname and its metadata must be updated when the blueprint is applied.</p>

<p>The file's content may alternately be specified as <code>template</code> and (optionally) <code>data</code> which contain a <code>mustache.sh</code> template in the <span class="man-ref"><code>mustache</code><span class="s">(5)</span></span> format and POSIX shell code, respectively.  When a blueprint is applied, the template should be given as standard input to <code>mustache.sh</code> with this data and other default data available in the environment.  The resulting standard output should be taken as the file's content.  A copy of <code>mustache.sh</code> is distributed with Blueprint.</p>

<p>For compatibility with AWS <code>cfn-init</code>, <code>source</code> takes precedence over <code>content</code>.  If a file with a <code>source</code> is encountered, the <code>source</code> URL should be fetched as the file's content.  Blueprint will never generate such objects.</p>

<h3 id="Packages">Packages</h3>

<p>Each key within <code>packages</code> names a package manager.  Each manager contains keys that name packages to be installed by that manager.  Each package name is associated with an array of versions that must be installed.  In most cases, for most managers, this array will have only one element.</p>

<p>Each manager is itself the name of a package that appears elsewhere.  <code>packages</code> must be processed by starting with the <code>apt</code>, <code>rpm</code>, and <code>yum</code> managers, installing their dependencies.  Any manager that was installed during this pass must next have its dependencies installed, continuing recursively until all managers and all dependencies have been installed.</p>

<p>For compatibility with AWS <code>cfn-init</code>, the <code>rpm</code> manager is included.  Packages managed by <code>rpm</code> specify URLs in place of version numbers.  If such a package is encountered, the URL should be installed via <span class="man-ref"><code>rpm</code><span class="s">(1)</span></span>.  Blueprint will never generate such objects.</p>

<h3 id="Services">Services</h3>

<p>Each key within <code>services</code> names a service manager.  Each manager contains keys that name services on the system.  Each service name is associated with a set of dependencies which themselves take a form much like a blueprint: <code>files</code> may be present and point to a list of pathnames; <code>packages</code> may be present and point to a set of package managers which each point to a list of packages; <code>sources</code> may be present and point to a list of directory names.</p>

<p>If any of the resources on which the service depends are changed, upgraded, initailized, or otherwise acted upon, the service should be restarted.</p>

<p>For compatibility with AWS <code>cfn-init</code>, <code>"enable": true</code> and <code>"ensure": "running"</code> are included with each service.  Blueprint ignores these when generating code.</p>

<h2 id="THEME-SONG">THEME SONG</h2>

<p>The Flaming Lips - "The W.A.N.D. (The Will Always Negates Defeat)"</p>

<h2 id="AUTHOR">AUTHOR</h2>

<p>Richard Crowley <a href="&#x6d;&#x61;&#105;&#108;&#116;&#x6f;&#x3a;&#x72;&#105;&#99;&#104;&#97;&#x72;&#100;&#64;&#x64;&#101;&#x76;&#x73;&#x74;&#114;&#117;&#x63;&#x74;&#x75;&#114;&#x65;&#x2e;&#x63;&#x6f;&#x6d;" data-bare-link="true">&#114;&#x69;&#x63;&#104;&#x61;&#114;&#100;&#64;&#100;&#101;&#x76;&#115;&#x74;&#x72;&#117;&#99;&#x74;&#x75;&#114;&#101;&#x2e;&#99;&#x6f;&#x6d;</a></p>

<h2 id="SEE-ALSO">SEE ALSO</h2>

<p>Part of <span class="man-ref"><code>blueprint</code><span class="s">(1)</span></span>.</p>

<p><span class="man-ref"><code>mustache</code><span class="s">(5)</span></span> at <a href="http://mustache.github.com/mustache.5.html" data-bare-link="true">http://mustache.github.com/mustache.5.html</a> and <code>mustache.sh</code> at <a href="https://github.com/rcrowley/mustache.sh" data-bare-link="true">https://github.com/rcrowley/mustache.sh</a>.</p>


  <ol class='man-decor man-foot man foot'>
    <li class='tl'>DevStructure</li>
    <li class='tc'>December 2011</li>
    <li class='tr'>blueprint(5)</li>
  </ol>

  </div>
</body>
</html>
